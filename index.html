<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Шкільний таймер</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#10b981" />
    <style>
        :root{
            --bg-lesson: #10b981;
            --bg-break: #ef4444;
            --bg-off: #1f2937;
            --text: #ffffff;
        }
        *{box-sizing:border-box}
        html,body{height:100%;margin:0}
        body{font-family:system-ui, sans-serif;color:var(--text);display:flex;align-items:center;justify-content:center;background:var(--bg-off);transition:background-color .3s ease;}
        .wrap{text-align:center;padding:20px;max-width:600px}
        .clock{font-size:3em;font-weight:bold;margin:.2em 0}
        .status{font-size:1.6em;font-weight:600;margin:.2em 0}
        .remain{font-size:2em;font-weight:bold;margin:.3em 0}
        .detail{opacity:.9;margin:.2em 0}
        .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.3);overflow:hidden}
        .bar{height:100%;width:0;background:#fff;transition:width .5s ease}
        .footer{font-size:.8em;opacity:.8;margin-top:1em}
    </style>
</head>
<body>
<div class="wrap">
    <div class="clock" id="clock">--:--:--</div>
    <div class="status" id="status">—</div>
    <div class="remain" id="remain">—</div>
    <div class="detail" id="detail">—</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <div class="footer" id="footer"></div>
</div>
<script>
    const lessons = [
        ["08:00","08:40"],["08:45","09:25"],["09:40","10:20"],["10:35","11:15"],["11:25","12:05"],
        ["12:10","12:50"],["12:55","13:35"],["13:40","14:20"],["14:35","15:15"],["15:30","16:10"],
        ["16:15","16:55"],["17:00","17:40"],["17:45","18:25"]
    ];
    function toMinutes(str){const [h,m]=str.split(":").map(Number);return h*60+m}
    function toHM(min){const h=Math.floor(min/60)%24,m=min%60;return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`}
    const timeline=[]; (function(){for(let i=0;i<lessons.length;i++){const [s,e]=lessons[i].map(toMinutes);timeline.push({type:"lesson",idx:i+1,startM:s,endM:e});const next=lessons[i+1];if(next){const [s2]=next.map(toMinutes);if(s2>e)timeline.push({type:"break",idx:i+1,nextIdx:i+2,startM:e,endM:s2});}}})();
    const elClock=document.getElementById('clock');
    const elStatus=document.getElementById('status');
    const elRemain=document.getElementById('remain');
    const elDetail=document.getElementById('detail');
    const elBar=document.getElementById('bar');
    const elFooter=document.getElementById('footer');
    const fmtTime=new Intl.DateTimeFormat('uk-UA',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const fmtDate=new Intl.DateTimeFormat('uk-UA',{weekday:'long',day:'2-digit',month:'2-digit',year:'numeric'});
    function nowMinutes(){const d=new Date();return d.getHours()*60+d.getMinutes()+d.getSeconds()/60}
    function secondsToHMS(sec){const s=Math.max(0,Math.floor(sec));const m=Math.floor(s/60);const r=s%60;return `${m}:${String(r).padStart(2,'0')}`}
    function setBg(type){if(type==='lesson')document.body.style.backgroundColor='var(--bg-lesson)';else if(type==='break')document.body.style.backgroundColor='var(--bg-break)';else document.body.style.backgroundColor='var(--bg-off)'}
    function describeCurrent(t){for(const item of timeline){if(t*60>=item.startM*60 && t*60<item.endM*60){const total=(item.endM-item.startM)*60;const elapsed=(t-item.startM)*60;return {state:item.type,item,remain:total-elapsed,progress:elapsed/total*100}}}const first=timeline[0].startM,last=timeline[timeline.length-1].endM;let nextLabel='';let remain=0;if(t<first){nextLabel=`до 1-го уроку о ${toHM(first)}`;remain=(first-t)*60}else if(t>=last){nextLabel='уроки завершилися'}else{const after=timeline.find(x=>x.startM>t);if(after){nextLabel=`до ${after.type==='lesson'?'уроку':'перерви'} о ${toHM(after.startM)}`;remain=(after.startM-t)*60}}return {state:'off',remain,progress:0,nextLabel}}
    function tick(){const d=new Date();elClock.textContent=fmtTime.format(d);elFooter.textContent=fmtDate.format(d);const t=nowMinutes();const info=describeCurrent(t);if(info.state==='lesson'){setBg('lesson');elStatus.textContent=`Урок №${info.item.idx}`;elDetail.textContent=`${toHM(info.item.startM)} – ${toHM(info.item.endM)}`;elRemain.textContent=`Залишилось: ${secondsToHMS(info.remain)}`;elBar.style.width=`${info.progress}%`}else if(info.state==='break'){setBg('break');elStatus.textContent=`Перерва (${info.item.idx}↔${info.item.nextIdx})`;elDetail.textContent=`${toHM(info.item.startM)} – ${toHM(info.item.endM)}`;elRemain.textContent=`Залишилось: ${secondsToHMS(info.remain)}`;elBar.style.width=`${info.progress}%`}else{setBg('off');elStatus.textContent='Неурочний час';elDetail.textContent=info.nextLabel;elRemain.textContent=info.remain>0?`Початок через: ${secondsToHMS(info.remain)}`:'Вільний час';elBar.style.width='0%'}requestAnimationFrame(()=>setTimeout(tick,500))}
    tick();


    if('serviceWorker' in navigator){
        window.addEventListener('load',()=>{
            navigator.serviceWorker.register('./sw.js');
        });
    }
</script>
</body>
</html>